# Sparrow SPOT Scale‚Ñ¢ v8.5.1 Release Notes

**Release Date:** December 7, 2025  
**Focus:** Legislative Threat Detection Suite & Bilingual PDF Processing

---

## Overview

Version 8.5.1 introduces the **Legislative Threat Detection Suite** - a comprehensive system for analyzing legislative documents for discretionary powers, accountability gaps, and democratic oversight risks. This release also includes intelligent bilingual PDF column extraction and zero-data-loss reporting.

**Major Achievement:** Successfully analyzed Bill C-15 (632 pages, 1.15M characters) detecting 925 discretionary power findings with CRITICAL risk classification.

---

## Summary of Changes

### üö® NEW FEATURE: Legislative Threat Detection Suite (v8.5.0)

#### 1. Discretionary Power Analyzer (DPA)
**File:** `discretionary_power_analyzer.py` (664 lines, NEW)

**Purpose:** Detect and analyze discretionary powers and accountability gaps in legislative documents.

**Pattern Detection (5 Types):**

| Pattern Type | Examples | Risk Level | Count in Bill C-15 |
|--------------|----------|------------|-------------------|
| **Permissive Language** | "may", "may by order" | MEDIUM | 784 |
| **Self-Judgment Clauses** | "in the minister's opinion", "if satisfied" | HIGH | 34 |
| **Undefined Timelines** | "as soon as feasible", "reasonable time" | MEDIUM | Included in 784 |
| **Broad Scope** | "any entity", "any federal law" | CRITICAL | 107 |
| **Exclusion Powers** | "may exclude", "may exempt", "may waive" | HIGH | Included in 34 |

**Scoring Algorithms:**
- **Discretionary Power Score** (0-100): Weighted pattern frequency
- **Power Concentration Index** (0-100): Aggregation of authority in single office
- **Risk Classification:** LOW / MEDIUM / HIGH / CRITICAL

**Output Files:**
```
[output]/threats/
‚îú‚îÄ‚îÄ [filename]_dpa_[timestamp].json      # Machine-readable findings
‚îî‚îÄ‚îÄ [filename]_dpa_[timestamp].md        # Human-readable report
```

**Bill C-15 Results:**
- Total Findings: 925
- Risk Level: **CRITICAL** (100/100 Discretionary Power Score)
- Discretionary Power Score: 100.00/100
- Power Concentration Index: 100.00/100
- Report Length: 1,565 lines (zero data loss)

---

### üîß ENHANCEMENT: Bilingual PDF Column Extraction (v8.5.0)

#### 2. PDF Column Detection & Extraction
**File:** `gui/sparrow_gui.py` - `extract_pdf_columns()` function (90 lines)

**Purpose:** Automatically detect and extract English-only text from bilingual (English/French) PDF documents.

**Detection Logic:**
```python
# Samples first 3 pages
# Detects bilingual if: french_words > 10 AND english_words > 5
# Extracts left column (English) using pdfplumber bounding box
```

**Text Cleaning:**
- Removes French text artifacts
- Strips page numbers and headers
- Cleans excess whitespace
- Removes garbled characters

**Bill C-15 Results:**
- Input: 632 pages, bilingual 2-column PDF
- Output: 1,152,779 characters clean English text
- French Interference: 0% (complete removal)
- Garbled Text: None (verified readable)

**Integration:**
- ‚úÖ Normal Analysis Mode: Auto-detects and extracts before analysis
- ‚úÖ Low Memory Mode (Subprocess): Extracts to temp file, cleans up after
- ‚úÖ Fallback: Uses standard extraction if not bilingual

**Dependencies:**
- `pdfplumber` library (auto-detected, graceful degradation if missing)

---

### üéØ IMPROVEMENT: Zero-Data-Loss Reporting (v8.5.1)

#### 3. Enhanced DPA Report Format
**File:** `discretionary_power_analyzer.py` - `_format_markdown_report()` method

**Problem (v8.5.0):** Original format showed only 10 findings per risk level, resulting in 90% data loss:
```
CRITICAL: 107 findings found
Showing 10 representative examples... and 97 more
```

**Solution (v8.5.1):** Hybrid reporting approach:

**CRITICAL/HIGH Findings:** Show ALL with full detail (100% coverage)
```
## CRITICAL Risk Findings (107 findings - ALL SHOWN)

### 1. Broad Scope: "any entity"
**Section:** Part 2, Division 3
**Context:** "The Minister may, by order, designate any entity..."
**Risk:** Unlimited scope with no defined criteria
```

**MEDIUM/LOW Findings:** Summary + Complete Reference Index (100% coverage)
```
## MEDIUM Risk Findings (784 findings - INDEXED)

### Representative Examples (5 shown):
[5 detailed examples with full context]

### Complete Index of All 784 MEDIUM Findings:
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ ID  ‚îÇ Pattern          ‚îÇ Location          ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ M1  ‚îÇ Permissive Lang  ‚îÇ Section 4.1, p.12 ‚îÇ
‚îÇ M2  ‚îÇ Permissive Lang  ‚îÇ Section 4.3, p.15 ‚îÇ
[... all 784 entries ...]
```

**Frequency Analysis:**
```
Pattern Frequency Distribution (MEDIUM):
  - permissive_language: 620 occurrences
  - undefined_timelines: 164 occurrences
```

**Results:**
- Report Length: 270 lines ‚Üí **1,565 lines** (5.8x expansion)
- Data Loss: 90% ‚Üí **0%** (all 925 findings captured)
- CRITICAL Findings: 10 ‚Üí **107** shown (100%)
- HIGH Findings: 10 ‚Üí **34** shown (100%)
- MEDIUM Findings: 10 examples + **784 complete index** (100%)

---

### üñ•Ô∏è GUI Integration

#### 4. GUI Enhancements
**File:** `gui/sparrow_gui.py` (1,961 ‚Üí 2,157 lines)

**New Features:**

**A. Legislative Threat Checkbox**
```
Transparency & Compliance Options:
‚òê Enable Deep Analysis (6-level transparency)
‚òë Run Discretionary Power Analysis    ‚Üê NEW
```

**B. Automatic PDF Extraction**
- Detects bilingual PDFs on upload
- Extracts English column automatically
- Shows extraction status in UI
- No user configuration needed

**C. Subprocess Support**
- PDF extraction runs before subprocess call
- Temp files created and cleaned up automatically
- Full integration with Low Memory Mode

**D. Status Updates**
```
Status: Analyzing bilingual PDF...
Status: Extracted 1,152,779 characters (English only)
Status: Running Discretionary Power Analysis...
Status: Generated threat report (925 findings)
```

---

### üíª CLI Integration

#### 5. CLI Flag: `--legislative-threat`
**File:** `sparrow_grader_v8.py` (3,155 ‚Üí 3,240 lines)

**Usage:**
```bash
python sparrow_grader_v8.py \
  --input bill_c15_english_only.txt \
  --output-dir outputs/bill_c15 \
  --legislative-threat
```

**Output:**
```
[Legislative Threat Detection]
‚úì Analyzing document for discretionary powers...
‚úì Detected 925 findings across 5 pattern types
‚úì Risk Level: CRITICAL (100/100)
‚úì Reports saved to: outputs/bill_c15/threats/
  - bill_c15_dpa_20251207_105422.json (machine-readable)
  - bill_c15_dpa_20251207_105422.md (human-readable, 1,565 lines)
```

**Integration:**
- Runs after main analysis
- Creates `threats/` subdirectory in output folder
- Saves JSON + Markdown reports
- Adds findings summary to main report

---

### üìä Core Module Changes

#### Updated Files:

| File | Lines (Old) | Lines (New) | Changes |
|------|-------------|-------------|---------|
| `sparrow_grader_v8.py` | 3,155 | 3,240 | +85 (DPA integration, CLI flag) |
| `gui/sparrow_gui.py` | 1,961 | 2,157 | +196 (PDF extraction, DPA checkbox, subprocess) |
| `discretionary_power_analyzer.py` | 0 | 664 | +664 (NEW module) |

#### New Files:

1. **discretionary_power_analyzer.py** (664 lines)
   - Main DPA analysis engine
   - 5 pattern types with 40+ regex patterns
   - Dual scoring algorithms
   - JSON + Markdown output generation
   - CLI interface

2. **extract_bill_columns.py** (~200 lines, standalone tool)
   - Standalone PDF column extraction utility
   - Used for testing and manual extraction
   - Can extract both columns or English-only

---

## Documentation Updates

### New Documentation:

1. **DPA_v8.5.1_IMPROVED_REPORTING.md** (504 lines)
   - Complete v8.5.1 implementation details
   - Bilingual PDF extraction guide
   - Output comparison (before/after)
   - Bill C-15 test results
   - Publication readiness checklist
   - User instructions (GUI + CLI)
   - Technical architecture
   - Validation & testing procedures

2. **TODO_v8.6_Enhanced_QA_System.md** (comprehensive)
   - Roadmap for enhanced Q&A with document chunking
   - Token calculator for model selection
   - Semantic search for large documents
   - Multi-chunk query strategies

### Updated Documentation:

1. **TECHNICAL_ARCHITECTURE_REPORT.md** (3,061 ‚Üí 3,286 lines)
   - Updated to v8.5 in header
   - Added v8.5.0 and v8.5.1 enhancements to executive summary
   - NEW Part 2.3: Legislative Threat Detection Suite (200+ lines)
   - Updated GUI section to v8.5 (size: 440 ‚Üí 2,157 lines)
   - Added `--legislative-threat` CLI flag documentation
   - Complete DPA module documentation with examples

2. **PROJECT_METRICS_REPORT.md** (Updated to v8.5.1)
   - Total Python Files: 46 ‚Üí 47
   - Total Lines of Code: 30,836 ‚Üí 31,521
   - Added `discretionary_power_analyzer.py` to module table
   - Updated strengths section with v8.5 features
   - Updated recent improvements with v8.5.1 work

---

## Testing & Validation

### Test Document: Bill C-15 (Budget Implementation Act, 2025)

**Document Characteristics:**
- Format: Bilingual PDF (English left column, French right column)
- Pages: 632
- File Size: ~50 MB
- Text Content: 1,152,779 characters (English only)

**Bilingual PDF Extraction Test:**
- ‚úÖ Detection: Correctly identified as bilingual (FR:207, EN:9)
- ‚úÖ Extraction: 1,152,779 chars clean English
- ‚úÖ Quality: 0% French interference, no garbled text
- ‚úÖ Speed: ~30 seconds for 632 pages

**DPA Analysis Test:**
- ‚úÖ Pattern Detection: All 5 types functional
- ‚úÖ Findings Count: 925 total (107 CRITICAL, 34 HIGH, 784 MEDIUM)
- ‚úÖ Risk Scoring: CRITICAL level (100/100 score) - validated
- ‚úÖ Report Generation: 1,565 lines, 0% data loss
- ‚úÖ File Output: JSON + Markdown both created successfully

**GUI Integration Test:**
- ‚úÖ PDF Upload: Accepts PDF files
- ‚úÖ Auto Extraction: Detects and extracts bilingual columns
- ‚úÖ DPA Checkbox: Triggers analysis correctly
- ‚úÖ Normal Mode: Analysis completes successfully
- ‚úÖ Subprocess Mode: Works with temp file cleanup
- ‚úÖ Output Display: Shows threat report summary

**CLI Integration Test:**
- ‚úÖ Flag Recognition: `--legislative-threat` parsed correctly
- ‚úÖ Directory Creation: `threats/` folder auto-created
- ‚úÖ File Saving: JSON + MD files saved to correct location
- ‚úÖ Report Integration: DPA findings added to main report

---

## Known Issues & Limitations

### v8.5.1 Limitations:

1. **PDF Extraction Accuracy**
   - Assumes standard 2-column layout (left=English, right=French)
   - May not work for non-standard layouts
   - Header/footer detection is heuristic-based

2. **Pattern Detection Scope**
   - Only English text analyzed (French sections ignored)
   - Patterns are regex-based (may miss complex phrasing)
   - Context windows limited to 300 chars

3. **Legislative Threat Detection Suite**
   - Phase 1 of 6 planned modules (only DPA complete)
   - 5 remaining modules planned: Transparency Theater Detector, Exemption Stacking Analyzer, Temporal Anomaly Detector, Oversight Mechanism Evaluator, Democratic Process Impact Assessor

4. **Model Recommendations**
   - No token calculator yet (planned for v8.6)
   - No automatic model selection for Q&A
   - Large documents may exceed context windows

### Workarounds:

- **Non-standard PDFs:** Use `extract_bill_columns.py` standalone tool and manually verify output
- **French Analysis:** Extract both columns and analyze French separately
- **Large Documents:** Use pre-extracted text files instead of PDFs
- **Pattern Misses:** Review JSON output and add custom patterns if needed

---

## Performance Metrics

### Bill C-15 Analysis Performance:

| Operation | Time | Notes |
|-----------|------|-------|
| PDF Upload | ~5 sec | 50 MB file transfer |
| Bilingual Detection | ~2 sec | Samples 3 pages |
| Column Extraction | ~30 sec | 632 pages, pdfplumber |
| DPA Analysis | ~45 sec | 925 findings, 1.15M chars |
| Report Generation | ~5 sec | 1,565-line markdown file |
| **Total Time** | **~90 sec** | End-to-end GUI analysis |

### Resource Usage:

- **Memory:** ~800 MB peak (PDF processing)
- **Disk I/O:** ~100 MB (temp files for subprocess)
- **CPU:** Single-threaded (regex pattern matching)

### Scalability:

- Tested up to 632 pages (Bill C-15)
- Estimated capacity: 1,000+ pages
- Performance: Linear O(n) with document size

---

## Dependencies

### New Dependencies:

```txt
pdfplumber>=0.10.0    # PDF column extraction (optional but recommended)
```

### Installation:

```bash
# Activate virtual environment
source .venv/bin/activate

# Install new dependency
pip install pdfplumber

# Verify installation
python -c "import pdfplumber; print('pdfplumber installed successfully')"
```

### Dependency Handling:

- **pdfplumber:** Optional dependency
  - If missing: GUI shows warning, falls back to standard PDF extraction
  - Graceful degradation: `PDFPLUMBER_AVAILABLE = False` flag
  - Installation prompt: "Install pdfplumber for bilingual PDF support"

---

## Migration Guide

### Upgrading from v8.4.2 to v8.5.1:

#### 1. Install New Dependencies
```bash
pip install pdfplumber
```

#### 2. No Breaking Changes
- All v8.4.2 functionality preserved
- New features are additive
- Existing analysis pipelines unchanged

#### 3. New Features Available Immediately
- **GUI:** Legislative Threat checkbox appears automatically
- **CLI:** `--legislative-threat` flag available
- **PDF:** Bilingual extraction runs automatically for PDFs

#### 4. Output Directory Changes
- New `threats/` subdirectory created for DPA outputs
- Existing output structure unchanged

#### 5. Configuration
- No configuration file changes needed
- DPA patterns are hardcoded (may be configurable in future)

### Backward Compatibility:

- ‚úÖ All v8.4.2 analysis methods work identically
- ‚úÖ Existing scripts/workflows continue to function
- ‚úÖ Output format extensions are additive (new files, no changes to existing)
- ‚úÖ GUI layout compatible (new controls added, existing preserved)

---

## Future Roadmap

### v8.5.2+ (Legislative Threat Detection Suite - Phases 2-6):

1. **Transparency Theater Detector**
   - Detects oversight language with escape clauses
   - "Subject to ministerial approval" + vague criteria
   - False accountability signals

2. **Exemption Stacking Analyzer**
   - Tracks cumulative exemptions
   - Identifies accountability black holes
   - Cross-references multiple exemption clauses

3. **Temporal Anomaly Detector**
   - Short pilot periods with long exemptions
   - Sunset clause analysis
   - Review timeline adequacy

4. **Oversight Mechanism Evaluator**
   - Assesses parliamentary review clauses
   - Checks reporting requirements
   - Evaluates enforcement mechanisms

5. **Democratic Process Impact Assessor**
   - Estimates public consultation bypassed
   - Tracks regulatory authority transfers
   - Flags order-in-council powers

### v8.6.0 (Enhanced Q&A System):

- Token calculator for model selection
- Intelligent document chunking (section-based, sliding window, semantic)
- Multi-chunk Q&A with answer synthesis
- Semantic search for large documents
- Comprehensive coverage for 600+ page documents

### v9.0.0 (Long-term):

- Trained document classifiers (ML-based)
- Multi-language support (full French analysis)
- REST API for ecosystem integration
- Real-time monitoring dashboard

---

## Contributors

**Development Team:**
- Legislative Threat Detection architecture
- Bilingual PDF extraction implementation
- Zero-data-loss reporting enhancement
- Comprehensive testing and validation

**Testing:**
- Bill C-15 (632 pages) - Primary test document
- Various bilingual PDFs for extraction testing
- Edge cases and error handling validation

---

## License

Sparrow SPOT Scale‚Ñ¢ - Proprietary Software  
¬© 2025 Sparrow SPOT Development Team

---

## Support & Resources

### Documentation:
- `docs/DPA_v8.5.1_IMPROVED_REPORTING.md` - Complete DPA guide
- `docs/TECHNICAL_ARCHITECTURE_REPORT.md` - System architecture (v8.5)
- `docs/TODO_v8.6_Enhanced_QA_System.md` - Future Q&A enhancements

### Test Files:
- `test_articles/Bill-C15/` - Bill C-15 test outputs
- `test_articles/Bill-C15/Legislative-Threats/threats/` - DPA analysis results

### Example Commands:

**GUI Launch:**
```bash
cd gui
python sparrow_gui.py
```

**CLI Analysis with DPA:**
```bash
python sparrow_grader_v8.py \
  --input test_articles/Bill-C15/bill_c15_english_only.txt \
  --output-dir test_articles/Bill-C15/v8.5.1_test \
  --legislative-threat
```

**PDF Column Extraction (Standalone):**
```bash
python extract_bill_columns.py \
  bill_c15.pdf \
  --output-english bill_c15_english_only.txt
```

---

## Version Information

**Release Version:** 8.5.1  
**Release Date:** December 7, 2025  
**Code Name:** Legislative Transparency Suite  
**Previous Version:** 8.4.2  
**Next Planned Version:** 8.6.0 (Enhanced Q&A)

**Version String:**
```python
SPARROW_VERSION = "8.5.1"
```

**Git Tag:** `v8.5.1`  
**Branch:** `main`

---

## Changelog Summary

### Added (v8.5.0 ‚Üí v8.5.1):
- ‚úÖ Legislative Threat Detection Suite (Phase 1: DPA)
- ‚úÖ Discretionary Power Analyzer (664 lines, 5 pattern types)
- ‚úÖ Bilingual PDF column extraction (automatic detection)
- ‚úÖ GUI legislative threat checkbox
- ‚úÖ CLI `--legislative-threat` flag
- ‚úÖ Zero-data-loss DPA reporting (1,565 lines vs 270)
- ‚úÖ Complete reference indices for MEDIUM/LOW findings
- ‚úÖ Frequency analysis tables
- ‚úÖ Subprocess support for PDF extraction
- ‚úÖ Comprehensive documentation (DPA_v8.5.1_IMPROVED_REPORTING.md)

### Changed:
- üìù `sparrow_grader_v8.py`: 3,155 ‚Üí 3,240 lines (+DPA integration)
- üìù `gui/sparrow_gui.py`: 1,961 ‚Üí 2,157 lines (+PDF extraction, DPA UI)
- üìù `TECHNICAL_ARCHITECTURE_REPORT.md`: 3,061 ‚Üí 3,286 lines (+Part 2.3)
- üìù `PROJECT_METRICS_REPORT.md`: Updated to v8.5.1 metrics

### Fixed:
- üêõ DPA report truncation (90% data loss ‚Üí 0% data loss)
- üêõ Bilingual PDF text quality (French interference removed)
- üêõ Context window issues for large documents (extraction preprocessing)

---

**END OF RELEASE NOTES**

*For technical support or questions, refer to TECHNICAL_ARCHITECTURE_REPORT.md or contact the development team.*
